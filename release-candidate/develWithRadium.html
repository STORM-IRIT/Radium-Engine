<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Radium Engine: How to contribute to Radium Libraries</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSsymbols.js", "TeX/AMSmath.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="radium-logo.webp"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Radium Engine
   &#160;<span id="projectnumber">1.5.25</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('develWithRadium.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">How to contribute to Radium Libraries</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul>
  <li class="level1">
    <a href="#autotoc_md109">Radium libraries</a>
  </li>
  <li class="level1">
    <a href="#pre_commit">Pre commit hook</a>
  </li>
  <li class="level1">
    <a href="#autotoc_md110">Radium test suite</a>
    <ul>
      <li class="level2">
        <a href="#autotoc_md111">Preliminaries</a>
      </li>
      <li class="level2">
        <a href="#autotoc_md112">How to write tests</a>
      </li>
    </ul>
  </li>
  <li class="level1">
    <a href="#autotoc_md113">Code coverage</a>
  </li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="autotoc_md109"></a>
Radium libraries</h1>
<p>Direct contributions to master are closed. We defer merge to master after our radium based projects (public or private) CI tests. To this end, please select release_candidate as a base branch of your pull requests.</p>
<h1><a class="anchor" id="pre_commit"></a>
Pre commit hook</h1>
<p>We provide a configuration file for <a href="https://pre-commit.com/" target="_blank">pre-commit</a>. Please install and use it, e.g.</p>
<div class="fragment"><div class="line">pip install pre-commit</div>
<div class="line">pre-commit install</div>
</div><!-- fragment --><p>This hook will check several formatting convention and cleanup your files' style on each commit. If some checks fail, it might have update automatically your code (hence just add again the modified file to your commit) or needs manual intervention. These script are also added as CI github check (to show any problems in case you have troubles to install the hook script).</p>
<h1><a class="anchor" id="autotoc_md110"></a>
Radium test suite</h1>
<h2><a class="anchor" id="autotoc_md111"></a>
Preliminaries</h2>
<p>Radium testing is done using two tools:</p>
<ul>
<li>CTest: the test system by CMake. It provides compilation, running and basic reporting mechanisms for tests.</li>
<li>Continuous Integration system: github action and codecov.io. We use these services to call CTest on several platforms (windows, ubuntu and MacOs) with several compilers, and validate any change made to the main repository.</li>
</ul>
<p>As a Radium contributor, and in most cases, you will have to work only with CTest, and let the CI system run your tests automatically. In this section we describe how to write a new test, how to insert it in the testing suite, and how to validate your results on your computer and the CI systems.</p>
<h2><a class="anchor" id="autotoc_md112"></a>
How to write tests</h2>
<p>There is two kind of tests, integration test and unit test. Tests are run with the <code>check</code> target and it's variant (<code>check_verbose</code>, <code>test</code>, <code>run_unittests</code>, <code>run_unittests_verbose</code>) or directly with <code>ctest</code>. Calling <code>make test</code> or running <code>ctest</code> only perform testing, without build anything (e.g. if the code base is changed), due to CMake way of working.</p>
<ul>
<li>integration test are based on program return values, using the ctest suite. The tests are set in <code>tests/integration/CMakeLists.txt</code>, see <code>add_test</code> <a href="https://cmake.org/cmake/help/latest/command/add_test.html" target="_blank">documentation</a>. Integration tests typically run some program, catch and analyze the output, compare to reference output etc.</li>
<li>unit test use Catch2 framework <a href="https://github.com/catchorg/Catch2/blob/devel/docs/tutorial.md" target="_blank">see tutorial</a></li>
</ul>
<p>Note that we target Unit Tests, which can be defined as: </p><blockquote class="doxtable">
<p>&zwj;The purpose of a unit test in software engineering is to verify the behavior of a relatively small piece of software, independently from other parts. Unit tests are narrow in scope, and allow us to cover all cases, ensuring that every single part works correctly.</p>
<p>Source: <a href="https://www.toptal.com/qa/how-to-write-testable-code-and-why-it-matters" target="_blank">https://www.toptal.com/qa/how-to-write-testable-code-and-why-it-matters</a> </p>
</blockquote>
<p>To add a unit test, create the test file in tests/unittest/LIB/mytestfile.cpp where LIB correspond to the library you are testing (Core, Engine, Gui, IO). Edit <code>tests/unittest/CMakeLists.txt</code> and add your test to the list of sources of <code>add_executable(unittests ...</code>. If your test needs data, add them to <code>tests/unittest/data</code>. unittest working dir is <code>tests/unittest</code> so you can refer your data with a relative path starting with <code>data</code>. No output file are allowed in unittest. <code>TEST_CASE</code> first argument is the unique test name, second argument is a list of optional tags. You can add independent <code>TEST_SECTION</code>s to your test, please refer to <a href="https://github.com/catchorg/Catch2/tree/devel/docs" target="_blank">catch2 documentation</a>.</p>
<p>Here is an example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;Core/Geometry/Obb.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;Core/Math/Math.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Core_2Types_8hpp.html">Core/Types.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;catch2/catch_test_macros.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line">TEST_CASE( <span class="stringliteral">&quot;Core/Geometry/Obb&quot;</span>, <span class="stringliteral">&quot;[unittests][Core][Core/Geometry][Obb]&quot;</span> ) {</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceRa_1_1Core.html">Ra::Core</a>;</div>
<div class="line">    SECTION( <span class="stringliteral">&quot;Simple tests&quot;</span> ) {</div>
<div class="line">        <span class="comment">// Check Obb and empty aabb</span></div>
<div class="line">        Aabb aabb;</div>
<div class="line">        <a class="code hl_class" href="classRa_1_1Core_1_1Geometry_1_1Obb.html">Geometry::Obb</a> obb( aabb, Transform::Identity() );</div>
<div class="line">        REQUIRE( obb.toAabb().isEmpty() );</div>
<div class="line">        REQUIRE( obb.toAabb().isApprox( aabb ) );</div>
<div class="line">        obb.transform().rotate( AngleAxis( Math::Pi, Vector3::UnitX() ) );</div>
<div class="line">        REQUIRE( obb.toAabb().isEmpty() );</div>
<div class="line">        REQUIRE( obb.toAabb().isApprox( aabb ) );</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclassRa_1_1Core_1_1Geometry_1_1Obb_html"><div class="ttname"><a href="classRa_1_1Core_1_1Geometry_1_1Obb.html">Ra::Core::Geometry::Obb</a></div><div class="ttdoc">An oriented bounding box.</div><div class="ttdef"><b>Definition</b> <a href="Obb_8hpp_source.html#l00011">Obb.hpp:12</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md113"></a>
Code coverage</h1>
<p>On PR, code coverage analysis is performed through a github action with help of codecov.io report.</p>
<p>You can run such analysis on your own (on linux system, not tested on other plateform) using lcov. First install <code>lcov</code>, <code>sed</code> and <code>xmllint</code> for the tests. It's probably on your system repositories, e.g.:</p>
<ul>
<li>for Debian: <code>sudo apt install lcov libxml2-utils</code></li>
<li>on MacOS: <code>brew install lcov libxml2</code></li>
</ul>
<p>You can generate <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_blank"><code>lcov</code></a> output files to check tests coverage. To this end <code>RADIUM_ENABLE_COVERAGE=ON</code> have to be passed to cmake, works on Linux in Debug. Then the target <code>coverage</code> builds and run all the necessary steps and produce a file <code>total.info</code> in your build dir. Please check CMakeLists.txt for the detailed steps, and <code>lcov documentation</code> for further processing of <code>total.info</code> to generate an html report.</p>
<p>Here are the example commands to run test and generate report.</p>
<div class="fragment"><div class="line">#some vars</div>
<div class="line">RADIUM_CONFIG=path/to/file/with/radium-options.cmake #like where external are built ... it&#39;s optionnal</div>
<div class="line">RADIUM_SOURCE=path/to/radium/main/CMakeLists.txt</div>
<div class="line"> </div>
<div class="line"># in you build path</div>
<div class="line">cmake -DCMAKE_BUILD_TYPE=Debug -DRADIUM_ENABLE_COVERAGE=ON -C ${RADIUM_CONFIG} ${RADIUM_SOURCE}</div>
<div class="line">cmake --build . --target coverage #build everything, with coverage enable, run test, perform analysis</div>
</div><!-- fragment --><p>output report is <code>./coverage/index.html</code>.</p>
<p><code>lcov</code> is quite slow to process files, <a href="https://github.com/RPGillespie6/fastcov/blob/master/fastcov.py" target="_blank"><code>fastcov</code></a> is a parallel alternative. To install fastcov: <code>pip3 install fastcov</code>.</p>
<p>Note: fastcov is currently supported by GNU gcov only, so we enable it only on UNIX systems, excluding MacOS. See more details at: <a href="https://github.com/RPGillespie6/fastcov/issues/36">https://github.com/RPGillespie6/fastcov/issues/36</a>.</p>
<p>and to run the analysis:</p>
<div class="fragment"><div class="line"># in you build path</div>
<div class="line">cmake -DCMAKE_BUILD_TYPE=Debug -DRADIUM_ENABLE_COVERAGE=ON -C RADIUM_CONFIG RADIUM_SOURCE</div>
<div class="line">cmake --build . --target coverag_fastcov #build everything, with coverage enable, run test, perform analysis</div>
</div><!-- fragment --><p>report is <code>./coverage_fastcov/index.html</code></p>
<p>For comparison on a Intel(R) Xeon(R) Silver 4210 CPU @ 2.20GHz (with radium build <code>cmake --build .</code> already done).</p>
<ul>
<li><code>time cmake --build . --target coverage</code> -&gt; 2:08.60 total</li>
<li><code>time cmake --build . --target coverage_fastcov</code> -&gt; 48.178 total </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="develmanual.html">Developer manual</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
