<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Radium Engine: Camera manipulation in Radium</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSsymbols.js", "TeX/AMSmath.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
<!-- ... other metadata & script includes ... -->
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
 DoxygenAwesomeDarkModeToggle.init()
</script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
 DoxygenAwesomeFragmentCopyButton.init()
</script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript">
 DoxygenAwesomeParagraphLink.init()
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="radium-logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Radium Engine
   &#160;<span id="projectnumber">1.4.8</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('develCameraManipulator.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Camera manipulation in Radium </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md46">Implementing a CameraManipulator</a></li>
<li class="level1"><a href="#autotoc_md47">Extending/Specializing an existing CameraManipulator</a></li>
<li class="level1"><a href="#autotoc_md48">Using a CameraManipulator</a></li>
</ul>
</div>
<div class="textblock"><p>The Radium Engine provides some classes that allow to extend the way one might interact with a camera in an application.</p>
<p>The class <code><a class="el" href="classRa_1_1Gui_1_1CameraManipulator.html" title="The CameraManipulator class is the generic class for camera manipulators.">Ra::Gui::CameraManipulator</a></code> defines the general interface for camera manipulator. All manipulators have common properties that allow to switch from one manipulator to one other without disturbing the visual and interactive behavior of the application.</p>
<h1><a class="anchor" id="autotoc_md46"></a>
Implementing a CameraManipulator</h1>
<p>In order to extend the set of <code><a class="el" href="classRa_1_1Gui_1_1CameraManipulator.html" title="The CameraManipulator class is the generic class for camera manipulators.">Ra::Gui::CameraManipulator</a></code> available in Radium or to develop a dedicated <code><a class="el" href="classRa_1_1Gui_1_1CameraManipulator.html" title="The CameraManipulator class is the generic class for camera manipulators.">Ra::Gui::CameraManipulator</a></code> for a <code><a class="el" href="classRa_1_1Gui_1_1Viewer.html">Ra::Gui::Viewer</a></code>-based application, programmers are intended to do the following, demonstrated by the class <code>FlightCameraManipulator</code>.</p>
<ol type="1">
<li>Define the class that must inherits from <code><a class="el" href="classRa_1_1Gui_1_1CameraManipulator.html" title="The CameraManipulator class is the generic class for camera manipulators.">Ra::Gui::CameraManipulator</a></code> and, in order to receive interaction events, from <code><a class="el" href="classRa_1_1Gui_1_1KeyMappingManageable.html" title="KeyMappingManageable decorator to use as CRTP.">Ra::Gui::KeyMappingManageable</a></code>. Note that a CameraManipulator is a <code>Q_OBJECT</code> <div class="fragment"><div class="line"><span class="keyword">class </span>RA_GUI_API FlightCameraManipulator : <span class="keyword">public</span> CameraManipulator,</div>
<div class="line">                                           <span class="keyword">public</span> KeyMappingManageable&lt;FlightCameraManipulator&gt;</div>
<div class="line">{</div>
<div class="line">    Q_OBJECT</div>
</div><!-- fragment --></li>
<li>Implement the constructors (default, copy). Note that it is also very important to implement a constructor that will take any <code><a class="el" href="classRa_1_1Gui_1_1CameraManipulator.html" title="The CameraManipulator class is the generic class for camera manipulators.">Ra::Gui::CameraManipulator</a></code> and will copy the base class before initializing the current manipulator. <div class="fragment"><div class="line">FlightCameraManipulator::FlightCameraManipulator( <span class="keyword">const</span> CameraManipulator&amp; other ) :</div>
<div class="line">    CameraManipulator( other ), m_keyMappingCallbackManager { KeyMapping::getContext() } {</div>
<div class="line">    m_flightSpeed = ( m_target - m_camera-&gt;getPosition() ).norm() / 10_ra;</div>
<div class="line">    initializeFixedUpVector();</div>
<div class="line">    setupKeyMappingCallbacks();</div>
<div class="line">    m_cameraSensitivity = 2_ra;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>Implement the <code><a class="el" href="classRa_1_1Gui_1_1KeyMappingManageable.html" title="KeyMappingManageable decorator to use as CRTP.">Ra::Gui::KeyMappingManageable</a></code> part of the class. This implies defining the method <code>void FlightCameraManipulator::configureKeyMapping_impl()</code> according to the semantic imposed by <code><a class="el" href="classRa_1_1Gui_1_1KeyMappingManageable.html" title="KeyMappingManageable decorator to use as CRTP.">Ra::Gui::KeyMappingManageable</a></code>. It is recommended that, when implementing this keymapping initialisation callback, a default configuration is defined and saved to the xml keymapping configuration file if this later does not already contains a configuration. This will allow the users to edit and customize the proposed keymapping configuration. <div class="fragment"><div class="line"><span class="keyword">using</span> FlightCameraKeyMapping = <a class="code" href="classRa_1_1Gui_1_1KeyMappingManageable.html">Ra::Gui::KeyMappingManageable&lt;FlightCameraManipulator&gt;</a>;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define KMA_VALUE( XX ) Gui::KeyMappingManager::KeyMappingAction Gui::FlightCameraManipulator::XX;</span></div>
<div class="line">KeyMappingFlightManipulator</div>
<div class="line"><span class="preprocessor">#undef KMA_VALUE</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> FlightCameraManipulator::configureKeyMapping_impl() {</div>
<div class="line"> </div>
<div class="line">    FlightCameraKeyMapping::setContext(</div>
<div class="line">        Gui::KeyMappingManager::getInstance()-&gt;getContext( <span class="stringliteral">&quot;FlightManipulatorContext&quot;</span> ) );</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ( KeyMapping::getContext().isInvalid() ) {</div>
<div class="line">        LOG( logWARNING )</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;CameraContext not defined (maybe the configuration file do not contains &quot;</span></div>
<div class="line">               <span class="stringliteral">&quot;it). Add it for default key mapping.&quot;</span>;</div>
<div class="line">        FlightCameraKeyMapping::setContext(</div>
<div class="line">            Gui::KeyMappingManager::getInstance()-&gt;addContext( <span class="stringliteral">&quot;FlightManipulatorContext&quot;</span> ) );</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define KMA_VALUE( XX )                                                                          \</span></div>
<div class="line"><span class="preprocessor">    XX = Gui::KeyMappingManager::getInstance()-&gt;getAction( FlightCameraKeyMapping::getContext(), \</span></div>
<div class="line"><span class="preprocessor">                                                           #XX );</span></div>
<div class="line">    KeyMappingFlightManipulator</div>
<div class="line"><span class="preprocessor">#undef KMA_VALUE</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> mgr     = Gui::KeyMappingManager::getInstance();</div>
<div class="line">    <span class="keyword">auto</span> context = FlightCameraKeyMapping::getContext();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// use wrapper to have reference in pair</span></div>
<div class="line">    <span class="keyword">using</span> ActionBindingPair = std::pair&lt;std::reference_wrapper&lt;KeyMappingManager::KeyMappingAction&gt;,</div>
<div class="line">                                        KeyMappingManager::EventBinding&gt;;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// don&#39;t use [] since reference don&#39;t have a default value. use at and insert instead.</span></div>
<div class="line">    std::map&lt;std::string, ActionBindingPair&gt; defaultBinding;</div>
<div class="line"> </div>
<div class="line">    defaultBinding.insert(</div>
<div class="line">        std::make_pair( std::string { <span class="stringliteral">&quot;FLIGHTMODECAMERA_PAN&quot;</span> },</div>
<div class="line">                        ActionBindingPair { FLIGHTMODECAMERA_PAN,</div>
<div class="line">                                            mgr-&gt;createEventBindingFromStrings(</div>
<div class="line">                                                <span class="stringliteral">&quot;LeftButton&quot;</span>, <span class="stringliteral">&quot;ShiftModifier&quot;</span> ) } ) );</div>
<div class="line"> </div>
<div class="line">    defaultBinding.insert( std::make_pair(</div>
<div class="line">        std::string { <span class="stringliteral">&quot;FLIGHTMODECAMERA_ROTATE&quot;</span> },</div>
<div class="line">        ActionBindingPair { FLIGHTMODECAMERA_ROTATE,</div>
<div class="line">                            mgr-&gt;createEventBindingFromStrings( <span class="stringliteral">&quot;LeftButton&quot;</span> ) } ) );</div>
<div class="line"> </div>
<div class="line">    defaultBinding.insert(</div>
<div class="line">        std::make_pair( std::string { <span class="stringliteral">&quot;FLIGHTMODECAMERA_ZOOM&quot;</span> },</div>
<div class="line">                        ActionBindingPair { FLIGHTMODECAMERA_ZOOM,</div>
<div class="line">                                            mgr-&gt;createEventBindingFromStrings(</div>
<div class="line">                                                <span class="stringliteral">&quot;LeftButton&quot;</span>, <span class="stringliteral">&quot;ControlModifier&quot;</span> ) } ) );</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> ( <span class="keyword">auto</span>&amp; [actionName, actionBinding] : defaultBinding ) {</div>
<div class="line">        <span class="keywordflow">if</span> ( actionBinding.first.get().isInvalid() ) {</div>
<div class="line">            LOG( logWARNING ) &lt;&lt; <span class="stringliteral">&quot;FlightManipulator action &quot;</span> &lt;&lt; actionName</div>
<div class="line">                              &lt;&lt; <span class="stringliteral">&quot; not defined in configuration file. Adding default keymapping.&quot;</span>;</div>
<div class="line">            actionBinding.first.get() = mgr-&gt;addAction( context, actionBinding.second, actionName );</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclassRa_1_1Gui_1_1KeyMappingManageable_html"><div class="ttname"><a href="classRa_1_1Gui_1_1KeyMappingManageable.html">Ra::Gui::KeyMappingManageable&lt; FlightCameraManipulator &gt;</a></div></div>
</div><!-- fragment --></li>
<li>Implement the inherited abstract method according to the wanted behavior of the <code><a class="el" href="classRa_1_1Gui_1_1CameraManipulator.html" title="The CameraManipulator class is the generic class for camera manipulators.">Ra::Gui::CameraManipulator</a></code></li>
</ol>
<h1><a class="anchor" id="autotoc_md47"></a>
Extending/Specializing an existing CameraManipulator</h1>
<p>The example application <code>CustomCameraManipulator</code> Demonstrate how to extend an existing manipulator and specialize its behavior for a given context. In the following code, the <code><a class="el" href="classRa_1_1Gui_1_1TrackballCameraManipulator.html" title="A Trackball manipulator for Cameras.">Ra::Gui::TrackballCameraManipulator</a></code> class is used to define a simple pan and zoom manipulator, simply by ignoring rotation events:</p>
<div class="fragment"><div class="line"><span class="comment">// Add simple Camera Manipulator with only translation and zoom</span></div>
<div class="line"><span class="keyword">class </span>CameraManipulator2D : <span class="keyword">public</span> <a class="code" href="classRa_1_1Gui_1_1TrackballCameraManipulator.html">Ra::Gui::TrackballCameraManipulator</a></div>
<div class="line">{</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">inline</span> CameraManipulator2D() : <a class="code" href="namespaceRa.html">Ra</a>::Gui::TrackballCameraManipulator() {</div>
<div class="line">        m_keyMappingCallbackManager.addEventCallback( TRACKBALLCAMERA_ROTATE, []( QEvent* ) {} );</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">inline</span> <span class="keyword">explicit</span> CameraManipulator2D( <span class="keyword">const</span> CameraManipulator&amp; other ) :</div>
<div class="line">        <a class="code" href="namespaceRa.html">Ra</a>::Gui::TrackballCameraManipulator( other ) {</div>
<div class="line">        m_keyMappingCallbackManager.addEventCallback( TRACKBALLCAMERA_ROTATE, []( QEvent* ) {} );</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="ttc" id="aclassRa_1_1Gui_1_1TrackballCameraManipulator_html"><div class="ttname"><a href="classRa_1_1Gui_1_1TrackballCameraManipulator.html">Ra::Gui::TrackballCameraManipulator</a></div><div class="ttdoc">A Trackball manipulator for Cameras.</div><div class="ttdef"><b>Definition:</b> <a href="TrackballCameraManipulator_8hpp_source.html#l00013">TrackballCameraManipulator.hpp:16</a></div></div>
<div class="ttc" id="anamespaceRa_html"><div class="ttname"><a href="namespaceRa.html">Ra</a></div><div class="ttdef"><b>Definition:</b> <a href="Cage_8cpp_source.html#l00003">Cage.cpp:3</a></div></div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md48"></a>
Using a CameraManipulator</h1>
<p>Using a <code><a class="el" href="classRa_1_1Gui_1_1CameraManipulator.html" title="The CameraManipulator class is the generic class for camera manipulators.">Ra::Gui::CameraManipulator</a></code> in a <code><a class="el" href="classRa_1_1Gui_1_1Viewer.html">Ra::Gui::Viewer</a></code>-based application is quite straightforward.</p>
<p>If one wants to set a first camera manipulator to a viewer</p>
<div class="fragment"><div class="line">myViewer-&gt;setCameraManipulator(</div>
<div class="line">        <span class="keyword">new</span> <a class="code" href="classRa_1_1Gui_1_1FlightCameraManipulator.html">Ra::Gui::FlightCameraManipulator</a>( width, height );</div>
<div class="ttc" id="aclassRa_1_1Gui_1_1FlightCameraManipulator_html"><div class="ttname"><a href="classRa_1_1Gui_1_1FlightCameraManipulator.html">Ra::Gui::FlightCameraManipulator</a></div><div class="ttdef"><b>Definition:</b> <a href="FlightCameraManipulator_8hpp_source.html#l00013">FlightCameraManipulator.hpp:15</a></div></div>
</div><!-- fragment --><p>If one wants to change the manipulator while keeping the actual visual state</p>
<div class="fragment"><div class="line">myViewer-&gt;setCameraManipulator(</div>
<div class="line">        <span class="keyword">new</span> <a class="code" href="classRa_1_1Gui_1_1FlightCameraManipulator.html">Ra::Gui::FlightCameraManipulator</a>( *( m_viewer-&gt;getCameraManipulator() ) ) );</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="develmanual.html">Developer manual</a></li><li class="navelem"><a class="el" href="api.html">API</a></li><li class="navelem"><a class="el" href="gui.html">Gui</a></li>
    <li class="footer">Generated on Fri Feb 17 2023 09:28:19 for Radium Engine by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
